---
import Notion from '../../components/Notion.astro';
import PostLayout from '../../layouts/PostLayout.astro';
import { getTableContent } from '../../lib/getTableData.ts';
import { getBlockTree } from '../../lib/getBlockTree.ts';

export async function getStaticPaths() {
  const res = await getTableContent();
  const table = res.results;
  return await Promise.all(
    table.map(async (post) => {
      const blocks = await getBlockTree(post.id);
      const postTitle = post.properties.slug.rich_text[0].plain_text;
      return {
        params: {
          post: post.id + '-' + postTitle,
        },
        props: { blocks },
      };
    })
  );
}

const { post } = Astro.params;
const { blocks } = Astro.props;
---

<PostLayout>
  <Notion {blocks} />
</PostLayout>
