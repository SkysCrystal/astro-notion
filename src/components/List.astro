---
import Text from './Text.astro'
import { getBlockData } from '../lib/getBlockData'
let { as: List = 'ul', block } = Astro.props;

console.log('block', block)

if (block.has_children) {
    block.rich_text = await Promise.all(block.rich_text.map(async (child) => {
    child.rich_text[0]['children'] = await getBlockData(child.id)
    console.log(child.rich_text[0].children[0])
    return child
  }))
}

if (!block.isWrapped) {
  block = block[block.type]
}

---

<List>
  {
      block.rich_text.map((child) => {
        const tag = child.tag;
        console.log('child: ', child)
        return (
          child.rich_text[0]?.children?.length > 0 ?
          (
            <Text as={tag} block={child}>
              <Astro.self block={child.rich_text[0].children[0]} />
            </Text>
          ) :
          <Text as={tag} block={child} />
        )
      })
  }
</List>
