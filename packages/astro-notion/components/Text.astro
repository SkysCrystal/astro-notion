---
import List from './List.astro';
import InlineCode from './InlineCode.astro';
import '../styles/global.css'
import { getStyles, getStyleString, getClassAttributes } from '../api/utils.ts'
const { as: Text = 'p', block, color } = Astro.props;

let objType: string;
Text === 'figcaption' ? objType = 'caption' : objType = 'rich_text'
let blockObjs = block[block.type][objType]


const getText = (blockObj) => {

  let text = blockObj.plain_text
  const styles = getStyles(blockObj)

  const classAttributes = getClassAttributes(blockObj)

  if (blockObj.href) {
    return `<a style='${styles}' href=${blockObj.href} ${getClassAttributes(blockObj)} >${text}</a>`
  }

  if (classAttributes || styles.length > 0) {
    text = `<span style='${styles}' ${classAttributes}>${blockObj.plain_text}</span>`;
  }

  if (block.type === 'to_do') {
    text = `
      <input type="checkbox" id="todo" name="todo" ${block[block.type].checked ? 'checked' : ''} />
      <label style='${styles}' ${classAttributes} for="todo">${blockObj.plain_text}</label>
    `
  }

  return text
}

---

<List {block} is_first={true} />
<Text style={`${getStyleString(color)}`} class:list={'notion-' + Text}>
  {
    blockObjs.map((blockObj) => {
      return (
        blockObj?.annotations.code
        ? <InlineCode text={blockObj.plain_text} />
        : <Fragment set:html={getText(blockObj)}></Fragment>
      )
    })
  }
  <slot />
</Text>
<List {block} is_last={true} />

